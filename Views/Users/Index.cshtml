@model IEnumerable<WaterTankerManager.Controllers.UserViewModel>

@{
    ViewData["Title"] = "Manage Users";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold text-dark mb-1">Users</h2>
            <p class="text-secondary mb-0">Manage system access and roles</p>
        </div>
        <a asp-action="Create" class="btn btn-primary d-flex align-items-center shadow-sm">
            <i class="fa-solid fa-plus me-2"></i> New User
        </a>
    </div>

    <div class="custom-table-container">
        <table class="custom-table">
            <thead>
                <tr>
                    <th>User / Email</th>
                    <th>Assigned Roles</th>
                    <th class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var user in Model)
                {
                    <tr>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="user-avatar-circle me-3 shadow-sm">
                                    @user.Email.Substring(0, 1).ToUpper()
                                </div>
                                <div>
                                    <div class="fw-bold text-dark">@user.Email</div>
                                    <small class="text-muted">ID: @user.Id.Substring(0, 8)...</small>
                                </div>
                            </div>
                        </td>
                        <td>
                            @foreach (var role in user.Roles.Split(", "))
                            {
                                var badgeClass = role == "Admin" ? "role-admin" : "role-user";
                                <span class="role-badge @badgeClass">@role</span>
                            }
                        </td>
                        <td class="text-end">
                            <a asp-action="Edit" asp-route-id="@user.Id" class="btn-icon btn-icon-edit me-2" title="Edit User">
                                <i class="fa-solid fa-pen"></i>
                            </a>
                            <button type="button" class="btn-icon btn-icon-delete" title="Delete User" onclick="confirmDelete('@user.Id')">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                            <form id="delete-form-@user.Id" asp-action="Delete" asp-route-id="@user.Id" method="post" style="display:none"></form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        function confirmDelete(userId) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#e74c3c', // Danger color
                cancelButtonColor: '#95a5a6',  // Secondary color
                confirmButtonText: 'Yes, delete user!',
                cancelButtonText: 'Cancel',
                customClass: {
                    popup: 'rounded-4 shadow-lg border-0',
                    confirmButton: 'btn btn-danger btn-lg px-4 rounded-3',
                    cancelButton: 'btn btn-secondary btn-lg px-4 rounded-3 ms-2'
                },
                buttonsStyling: false
            }).then((result) => {
                if (result.isConfirmed) {
                    document.getElementById('delete-form-' + userId).submit();
                }
            })
        }
    </script>
}
